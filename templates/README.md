# 模板目录结构说明

本目录存储所有处理模板，按操作模板对象名称组织。

## 目录结构

```
templates/
├── atm/                    # 奥特曼模板目录
│   ├── atm_birthday.json  # 奥特曼生日主题模板
│   ├── atm_children_day.json  # 奥特曼儿童节主题模板
│   ├── background.jpg     # 背景图片
│   └── character.png      # 角色图片
├── elsa/                   # 艾莎公主模板目录
│   ├── elsa_birthday.json  # 艾莎公主生日主题模板
│   ├── background.jpg     # 背景图片
│   └── character.png      # 角色图片
└── README.md              # 本文件
```

## 命名约定

### 目录命名
- 目录名称 = 操作模板对象名称（如：atm、elsa）

### 模板文件命名
- 文件名 = 操作模板对象名称_主题.json
- 例如：atm_birthday.json、elsa_birthday.json

## 模板文件结构

每个模板文件包含以下元数据：

```json
{
  "name": "模板名称",
  "description": "模板描述",
  "version": "1.0",
  "character": "操作模板对象名称",
  "theme": "主题名称",
  "parameters": { ... },
  "tasks": [ ... ]
}
```

## 资源文件约定

### 预定义资源
- 所有预定义的媒体资源（背景图片、角色图片等）必须放在模板文件所在的同一目录下
- 资源路径在模板中使用相对路径引用（如："background.jpg"）

### 用户上传资源
- 用户上传的图片通过参数传递，不在模板目录中
- 模板执行过程中生成的文件存储在output目录中

## TTS任务约定

### 预编码特征方式
- TTS任务默认使用预编码特征方式调用
- 预编码特征ID自动设置为操作模板对象名称
- 不需要在模板中设置 `reference_audio` 参数

### 示例
```json
{
  "id": "tts",
  "name": "语音合成",
  "type": "tts",
  "params": {
    "text": "${tts_text}"
  }
}
```

系统会自动添加：
```json
{
  "feat_id": "atm"
}
```

## 添加新模板

1. 创建操作模板对象名称的子目录（如：templates/spiderman/）
2. 在子目录中创建模板文件（如：spiderman_birthday.json）
3. 将所需的资源文件放在同一目录中
4. 重新加载应用，模板将自动加载

## 注意事项

1. **模板验证**：系统会自动验证模板格式，确保必需字段存在
2. **参数替换**：支持使用 `${parameter_name}` 引用参数
3. **任务依赖**：使用 `depends_on` 字段定义任务依赖关系
4. **资源路径**：预定义资源使用相对路径，系统会自动解析

## 示例模板

### 奥特曼生日模板
- 文件：`templates/atm/atm_birthday.json`
- 特点：
  - 使用预编码特征方式调用TTS
  - 渐变色花字（天蓝色到白色）
  - 走马灯动效
  - 支持用户图片上传

### 艾莎公主生日模板
- 文件：`templates/elsa/elsa_birthday.json`
- 特点：
  - 使用预编码特征方式调用TTS
  - 渐变色花字（粉色到白色）
  - 心心动效
  - 支持用户图片上传

## 故障排除

### 模板未加载
1. 检查模板文件是否在正确的子目录中
2. 检查文件名是否符合命名约定
3. 检查JSON格式是否正确
4. 查看日志了解详细错误信息

### 资源文件未找到
1. 确保资源文件与模板文件在同一目录中
2. 检查资源文件名是否正确
3. 检查模板中的路径引用是否正确

### TTS任务失败
1. 确保已为操作模板对象保存预编码特征
2. 检查操作模板对象名称是否正确
3. 查看日志了解详细错误信息